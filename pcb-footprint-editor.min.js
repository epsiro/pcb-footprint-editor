function ElementLine(a,b,c,d,e){this.line_number=0;var f=this;this.x1=a,this.y1=b,this.x2=c,this.y2=d,this.thickness=e,this.line=paper.line(0,0,0,0).attr({stroke:"black",strokeLinecap:"round"}),this.anchor_c=paper.circle(0,0,anchor_size).addClass("anchor_c"),this.anchor_e1=paper.circle(0,0,anchor_size).addClass("anchor_e1"),this.anchor_e2=paper.circle(0,0,anchor_size).addClass("anchor_e2"),this.anchors=paper.group(this.anchor_c,this.anchor_e1,this.anchor_e2).attr({fill:"white",stroke:"red",strokeWidth:2,visibility:"hidden"}),this.update_anchors();var g=function(){this.original_x1=f.x1,this.original_y1=f.y1,this.original_x2=f.x2,this.original_y2=f.y2,this.original_thickness=f.thickness,global_dragging=!0,j()},h=function(a,b){var c=10;switch(this.node.classList[0]){case"anchor_c":f.x1=this.original_x1+view_to_nm(Snap.snapTo(c,a/zoom_level,30)),f.y1=this.original_y1-view_to_nm(Snap.snapTo(c,b/zoom_level,30)),f.x2=this.original_x2+view_to_nm(Snap.snapTo(c,a/zoom_level,30)),f.y2=this.original_y2-view_to_nm(Snap.snapTo(c,b/zoom_level,30));break;case"anchor_e1":f.x1=this.original_x1+view_to_nm(Snap.snapTo(c,a/zoom_level,30)),f.y1=this.original_y1-view_to_nm(Snap.snapTo(c,b/zoom_level,30));break;case"anchor_e2":f.x2=this.original_x2+view_to_nm(Snap.snapTo(c,a/zoom_level,30)),f.y2=this.original_y2-view_to_nm(Snap.snapTo(c,b/zoom_level,30))}f.update_editor()},i=function(){global_dragging=!1,k()},j=function(){1!=global_dragging&&(f.line.attr({stroke:"#222"}),f.anchors.attr({visibility:"visible"}),editor.addLineClass(f.line_number,"background","selected_pad"))},k=function(){1!=global_dragging&&(f.line.attr({stroke:"black"}),f.anchors.attr({visibility:"hidden"}),editor.removeLineClass(f.line_number,"background","selected_pad"))};if(this.anchor_c.drag(h,g,i),this.anchor_e1.drag(h,g,i),this.anchor_e2.drag(h,g,i),this.graphical_group=paper.group(this.line,this.anchors),this.graphical_group.hover(j,k),this.graphical_group.attr({"class":"elementline"}),1!=file_loaded){j();var l=new Event("mousedown");l.clientX=$("#svg").offset().left+origin_x+nm_to_view(this.x1),l.clientY=$("#svg").offset().top+origin_y-nm_to_view(this.y1),this.anchor_e2.node.dispatchEvent(l)}}function parse_elementline(a){if(!a.match(/ElementLine/))throw new UserException("InvalidFormat");code_line=a.substring(a.indexOf("[")+1).match(/\S+/g);var b=parse_length(code_line[0]),c=parse_length(code_line[1]),d=parse_length(code_line[2]),e=parse_length(code_line[3]),f=parse_length(code_line[4]);return{x1:b,y1:c,x2:d,y2:e,thickness:f}}function add_elementline(a){var b=view_to_nm($("#svg").offset().left+(a.clientX-origin_x)/zoom_level),c=view_to_nm($("#svg").offset().top+-(a.clientY-origin_y)/zoom_level);b=Math.round(b/mm_to_nm(.1))*mm_to_nm(.1),c=Math.round(c/mm_to_nm(.1))*mm_to_nm(.1);var d=b,e=c,f=mm_to_nm(.2);code=sprintf("    ElementLine[%.2fmm %.2fmm %.2fmm %.2fmm %.2fmm]\n",nm_to_mm(b),nm_to_mm(c),nm_to_mm(d),nm_to_mm(e),nm_to_mm(f)),editor.replaceRange(code,{line:get_last_line(),ch:0})}function list_folders_from_lib(){1!=hidden?(hidden=!0,$("div#lib").hide(),$("div#lib").css("width","0%"),$("div#graphical_editor").css("width","50%"),$("div#code").css("width","50%")):(hidden=!1,$("div#lib").show(),$("div#lib").css("width","20%"),$("div#graphical_editor").css("width","40%"),$("div#code").css("width","40%"));var a="https://api.github.com/repos/Lindem-Data-Acquisition-AS/gedalib/git/trees/4a7f27695351fa8a9d97f7b2edc189b4340885d0";$.getJSON(a,function(a){var b=[];$.each(a.tree,function(a,c){b.push("<li role='presentation'><i class='fa-li fa fa-folder'></i><a role='menuitem' href='#' class='folder' data-url='"+c.url+"'>"+c.path+"</a></li>")}),$("ul#gedalib").html(b.join(""))})}function list_components_in_folder(){$("ul#gedalib li ul").remove(),$("ul#gedalib li i").attr("class","fa fa-li fa-folder");var a=$(this).data("url"),b=this;$.getJSON(a,function(a){var c=[];$.each(a.tree,function(a,b){c.push("<li><i class='fa-li fa fa-file-code-o'></i><a href='#' class='file' data-url='"+b.url+"'>"+b.path+"</a></li>")}),$("<ul/>",{"class":"components fa-ul",html:c.join("")}).appendTo($(b).parent())}),$(this).parent().find("i").attr("class","fa fa-li fa-folder-open")}function load_component_from_folder(){var a=$(this).data("url");$.getJSON(a,function(a){file_loaded=!0,new_component(),editor.setValue(atob(a.content))})}function add_object(a,b){return a.match(/Pad/)?(values=parse_pad_line(a),object_instance=new Pad(b,b,values.x1,values.y1,values.x2,values.y2,values.thickness,values.mask_thickness),console.log("Pad added in objects[%d]: ",b),object_instance.draw(),zoom_group.add(object_instance.graphical_group),soldermask_group.add(object_instance.mask),objects.splice(b,0,object_instance),objects.forEach(update_line_number),0):a.match(/ElementLine/)?(values=parse_elementline(a),object_instance=new ElementLine(values.x1,values.y1,values.x2,values.y2,values.thickness),console.log("ElementLine added in objects[%d]: ",b),object_instance.draw(),zoom_group.add(object_instance.graphical_group),objects.splice(b,0,object_instance),objects.forEach(update_line_number),0):a.match(/Pin/)?(values=parse_pin(a),object_instance=new Pin(values.cx,values.cy,values.pad_diameter,values.clearance,values.mask_diameter,values.hole_diameter),console.log("Pin added in objects[%d]: ",b),object_instance.draw(),zoom_group.add(object_instance.graphical_group),soldermask_group.add(object_instance.mask),objects.splice(b,0,object_instance),objects.forEach(update_line_number),0):1}function remove_object(a,b){return object_instance=objects[b],void 0===object_instance?1:"placeholder"===object_instance?1:(object_instance.graphical_group.remove(),void 0!=object_instance.mask&&object_instance.mask.remove(),objects.splice(b,1),console.log("Object removed: ",object_instance),objects.forEach(update_line_number),0)}function edit_object(a,b){return a.match(/Pad/)?(values=parse_pad_line(a),objects[b].x1=values.x1,objects[b].y1=values.y1,objects[b].x2=values.x2,objects[b].y2=values.y2,objects[b].thickness=values.thickness,objects[b].draw(),0):a.match(/ElementLine/)?(values=parse_elementline(a),objects[b].x1=values.x1,objects[b].y1=values.y1,objects[b].x2=values.x2,objects[b].y2=values.y2,objects[b].thickness=values.thickness,objects[b].draw(),0):a.match(/Pin/)?(values=parse_pin(a),objects[b].cx=values.cx,objects[b].cy=values.cy,objects[b].pad_diameter=values.pad_diameter,objects[b].clearance=values.clearance,objects[b].mask_diameter=values.mask_diameter,objects[b].hole_diameter=values.hole_diameter,objects[b].draw(),0):1}function update_line_number(a){a.line_number=objects.indexOf(a)}function dblclick_handler(a){file_loaded=!1,"pad"==tool_state?add_pad(a):"elementline"==tool_state?add_elementline(a):"pin"==tool_state&&add_pin(a)}function Pad(a,b,c,d,e,f,g,h){this.pad_number=a,this.line_number=b;var i=this;this.x1=c,this.y1=d,this.x2=e,this.y2=f,this.thickness=g,this.mask_margin=h-g;this.get_pad_size();this.anchor_c=paper.circle(0,0,anchor_size).addClass("anchor_c"),this.anchor_n=paper.circle(0,0,anchor_size).addClass("anchor_n"),this.anchor_e=paper.circle(0,0,anchor_size).addClass("anchor_e"),this.anchor_s=paper.circle(0,0,anchor_size).addClass("anchor_s"),this.anchor_w=paper.circle(0,0,anchor_size).addClass("anchor_w"),this.anchor_ne=paper.circle(0,0,anchor_size).addClass("anchor_ne"),this.anchor_nw=paper.circle(0,0,anchor_size).addClass("anchor_nw"),this.anchor_se=paper.circle(0,0,anchor_size).addClass("anchor_se"),this.anchor_sw=paper.circle(0,0,anchor_size).addClass("anchor_sw"),this.anchors=paper.group(this.anchor_c,this.anchor_n,this.anchor_e,this.anchor_s,this.anchor_w,this.anchor_ne,this.anchor_nw,this.anchor_se,this.anchor_sw).attr({fill:"white",stroke:"#445",strokeWidth:2,visibility:"hidden"}),this.update_anchors(),this.pad=paper.line(0,0,0,0).attr({stroke:"#8c96a0",strokeWidth:0,strokeLinecap:"square"}),this.mask=paper.line(0,0,0,0).attr({stroke:"black",strokeWidth:0,strokeLinecap:"square"}),this.pad_line_ref=paper.line(0,0,0,0).attr({stroke:"red",strokeWidth:2});var j=function(){i.get_pad_size();"true"!=this.attr("endpoint")&&1!=i.endpoint?1!=global_first_endpoint?(i.endpoint=!0,i.endpoint_nr=1,i.endpoint_anchor=this,global_first_endpoint=!0,global_first_endpoint_object=i,this.attr({visibility:"visible",endpoint:"true",stroke:"red"}),i.update_distance_marker()):1!=global_second_endpoint&&(i.endpoint=!0,i.endpoint_nr=2,i.endpoint_anchor=this,global_second_endpoint=!0,global_second_endpoint_object=i,this.attr({visibility:"visible",endpoint:"true",stroke:"blue"}),i.update_distance_marker()):"true"==this.attr("endpoint")&&(1==i.endpoint_nr&&(i.endpoint_nr=0,global_first_endpoint=!1,global_first_endpoint_object=null),2==i.endpoint_nr&&(i.endpoint_nr=0,global_second_endpoint=!1,global_second_endpoint_object=null),i.endpoint_anchor=null,i.endpoint=!1,this.attr({visibility:"",endpoint:"false",stroke:"#445"})),1==global_first_endpoint&&1==global_second_endpoint?(distance_x.attr({visibility:"visible"}),distance_y.attr({visibility:"visible"}),$("#status_xy_distance").parent().show()):(distance_x.attr({visibility:"hidden"}),distance_y.attr({visibility:"hidden"}),$("#status_xy_distance").parent().hide())},k=function(){this.pad_size_original=i.get_pad_size(),global_dragging=!0,n()},l=function(a,b){var c=10;switch(this.node.classList[0]){case"anchor_n":var d={x:this.pad_size_original.x,y:this.pad_size_original.y,width:this.pad_size_original.width,height:this.pad_size_original.height-view_to_nm(Snap.snapTo(c,b/zoom_level,30))};break;case"anchor_e":var d={x:this.pad_size_original.x,y:this.pad_size_original.y,width:this.pad_size_original.width+view_to_nm(Snap.snapTo(c,a/zoom_level,30)),height:this.pad_size_original.height};break;case"anchor_s":var d={x:this.pad_size_original.x,y:this.pad_size_original.y-view_to_nm(Snap.snapTo(c,b/zoom_level,30)),width:this.pad_size_original.width,height:this.pad_size_original.height+view_to_nm(Snap.snapTo(c,b/zoom_level,30))};break;case"anchor_w":var d={x:this.pad_size_original.x+view_to_nm(Snap.snapTo(c,a/zoom_level,30)),y:this.pad_size_original.y,width:this.pad_size_original.width-view_to_nm(Snap.snapTo(c,a/zoom_level,30)),height:this.pad_size_original.height};break;case"anchor_sw":var d={x:this.pad_size_original.x+view_to_nm(Snap.snapTo(c,a/zoom_level,30)),y:this.pad_size_original.y-view_to_nm(Snap.snapTo(c,b/zoom_level,30)),width:this.pad_size_original.width-view_to_nm(Snap.snapTo(c,a/zoom_level,30)),height:this.pad_size_original.height+view_to_nm(Snap.snapTo(c,b/zoom_level,30))};break;case"anchor_se":var d={x:this.pad_size_original.x,y:this.pad_size_original.y-view_to_nm(Snap.snapTo(c,b/zoom_level,30)),width:this.pad_size_original.width+view_to_nm(Snap.snapTo(c,a/zoom_level,30)),height:this.pad_size_original.height+view_to_nm(Snap.snapTo(c,b/zoom_level,30))};break;case"anchor_ne":var d={x:this.pad_size_original.x,y:this.pad_size_original.y,width:this.pad_size_original.width+view_to_nm(Snap.snapTo(c,a/zoom_level,30)),height:this.pad_size_original.height-view_to_nm(Snap.snapTo(c,b/zoom_level,30))};break;case"anchor_nw":var d={x:this.pad_size_original.x+view_to_nm(Snap.snapTo(c,a/zoom_level,30)),y:this.pad_size_original.y,width:this.pad_size_original.width-view_to_nm(Snap.snapTo(c,a/zoom_level,30)),height:this.pad_size_original.height-view_to_nm(Snap.snapTo(c,b/zoom_level,30))};break;default:var d={x:this.pad_size_original.x+view_to_nm(Snap.snapTo(c,a/zoom_level,30)),y:this.pad_size_original.y-view_to_nm(Snap.snapTo(c,b/zoom_level,30)),width:this.pad_size_original.width,height:this.pad_size_original.height}}i.set_pad_size(d),i.update_editor()},m=function(){global_dragging=!1},n=function(){1!=global_dragging&&(i.pad.attr({stroke:"#acb6c0"}),i.anchors.attr({visibility:"visible"}),editor.addLineClass(i.line_number,"background","selected_pad"))},o=function(){1!=global_dragging&&(i.pad.attr({stroke:"#8c96a0"}),i.anchors.attr({visibility:"hidden"}),editor.removeLineClass(i.line_number,"background","selected_pad"))};this.anchor_c.drag(l,k,m),this.anchor_n.drag(l,k,m),this.anchor_e.drag(l,k,m),this.anchor_s.drag(l,k,m),this.anchor_w.drag(l,k,m),this.anchor_ne.drag(l,k,m),this.anchor_nw.drag(l,k,m),this.anchor_se.drag(l,k,m),this.anchor_sw.drag(l,k,m),this.pad.drag(l,k,m),this.anchor_c.click(j),this.anchor_n.click(j),this.anchor_e.click(j),this.anchor_s.click(j),this.anchor_w.click(j),this.anchor_ne.click(j),this.anchor_nw.click(j),this.anchor_se.click(j),this.anchor_sw.click(j),this.graphical_group=paper.group(this.pad,this.mask,this.pad_line_ref,this.anchors),this.graphical_group.hover(n,o),this.graphical_group.attr({"class":"pad"})}function add_pad(a){if("dblclick"==a.type){var b=view_to_nm($("#svg").offset().left+(a.clientX-origin_x)/zoom_level),c=view_to_nm($("#svg").offset().top+-(a.clientY-origin_y)/zoom_level);b=Math.round(b/mm_to_nm(.1))*mm_to_nm(.1),c=Math.round(c/mm_to_nm(.1))*mm_to_nm(.1)}else var b=0,c=0;var d=b,e=c,f=mm_to_nm(.6),g=mm_to_nm(.8);pad_code=sprintf('    Pad[%.2fmm %.2fmm %.2fmm %.2fmm %.2fmm 0.6mm %.2fmm "" "1" "square"]\n',nm_to_mm(b),nm_to_mm(c),nm_to_mm(d),nm_to_mm(e),nm_to_mm(f),nm_to_mm(g)),editor.replaceRange(pad_code,{line:get_last_line(),ch:0})}function parse_pad_line(a){if(!a.match(/Pad/))throw new UserException("InvalidFormat");code_line=a.substring(a.indexOf("[")+1).match(/\S+/g);var b=parse_length(code_line[0]),c=parse_length(code_line[1]),d=parse_length(code_line[2]),e=parse_length(code_line[3]),f=parse_length(code_line[4]),g=parse_length(code_line[5]),h=parse_length(code_line[6]);return{x1:b,y1:c,x2:d,y2:e,thickness:f,clearance:g,mask_thickness:h}}function Pin(a,b,c,d,e,f){this.line_number=0;var g=this;this.cx=a,this.cy=b,this.hole_diameter=f,this.pad_diameter=c,this.mask_margin=e-c,this.clearance=d,this.pad=paper.circle(0,0,0).attr({fill:"#8c96a0"}),this.mask=paper.circle(0,0,0).attr({stroke:"none",fill:"black"}),this.hole=paper.circle(0,0,0).attr({fill:"white"}),console.log(this),this.anchor_c=paper.circle(0,0,anchor_size).addClass("anchor_c"),this.anchor_h=paper.circle(0,0,anchor_size).addClass("anchor_h"),this.anchor_p=paper.circle(0,0,anchor_size).addClass("anchor_p"),console.log(this),this.anchors=paper.group(this.anchor_c,this.anchor_h,this.anchor_p).attr({fill:"white",stroke:"#445",strokewidth:2,visibility:"hidden"}),this.update_anchors();var h=function(){this.original_cx=g.cx,this.original_cy=g.cy,this.original_hole_diameter=g.hole_diameter,this.original_pad_diameter=g.pad_diameter,global_dragging=!0,k()},i=function(a,b){var c=10;switch(this.node.classList[0]){case"anchor_c":g.cx=this.original_cx+view_to_nm(Snap.snapTo(c,a/zoom_level,30)),g.cy=this.original_cy-view_to_nm(Snap.snapTo(c,b/zoom_level,30));break;case"anchor_h":var d=this.original_hole_diameter+view_to_nm(2*Snap.snapTo(c,a/zoom_level,30));d>0&&d<g.pad_diameter&&(g.hole_diameter=d);break;case"anchor_p":var e=this.original_pad_diameter+view_to_nm(2*Snap.snapTo(c,a/zoom_level,30));e>0&&e>g.hole_diameter&&(g.pad_diameter=e)}g.update_editor()},j=function(){global_dragging=!1,l()},k=function(){1!=global_dragging&&(g.pad.attr({fill:"#acb6c0"}),g.anchors.attr({visibility:"visible"}),editor.addLineClass(g.line_number,"background","selected_pad"))},l=function(){1!=global_dragging&&(g.pad.attr({fill:"#8c96a0"}),g.anchors.attr({visibility:"hidden"}),editor.removeLineClass(g.line_number,"background","selected_pad"))};this.anchor_c.drag(i,h,j),this.anchor_h.drag(i,h,j),this.anchor_p.drag(i,h,j),this.graphical_group=paper.group(this.pad,this.mask,this.hole,this.anchors),this.graphical_group.hover(k,l),this.graphical_group.attr({"class":"pin"})}function parse_pin(a){if(!a.match(/Pin/))throw new UserException("InvalidFormat");code_line=a.substring(a.indexOf("[")+1).match(/\S+/g);var b=parse_length(code_line[0]),c=parse_length(code_line[1]),d=parse_length(code_line[2]),e=parse_length(code_line[3]),f=parse_length(code_line[4]),g=parse_length(code_line[5]);return{cx:b,cy:c,pad_diameter:d,clearance:e,mask_diameter:f,hole_diameter:g}}function add_pin(a){var b=view_to_nm($("#svg").offset().left+(a.clientX-origin_x)/zoom_level),c=view_to_nm($("#svg").offset().top+-(a.clientY-origin_y)/zoom_level);b=Math.round(b/mm_to_nm(.1))*mm_to_nm(.1),c=Math.round(c/mm_to_nm(.1))*mm_to_nm(.1);var d=mm_to_nm(.4),e=mm_to_nm(1),f=mm_to_nm(.1),g=mm_to_nm(1.2);code=sprintf('    Pin[%.2fmm %.2fmm %.2fmm %.2fmm %.2fmm %.2fmm "" "" ""]\n',nm_to_mm(b),nm_to_mm(c),nm_to_mm(e),nm_to_mm(f),nm_to_mm(g),nm_to_mm(d)),editor.replaceRange(code,{line:get_last_line(),ch:0})}function save_text_as_file(){var a=editor.getValue(),b=new Blob([a],{type:"text/plain"}),c="component.fp",d=document.createElement("a");d.download=c,d.innerHTML="Download File",null!=window.webkitURL?d.href=window.webkitURL.createObjectURL(b):(d.href=window.URL.createObjectURL(b),d.onclick=destroy_clicked_element,d.style.display="none",document.body.appendChild(d)),d.click()}function destroy_clicked_element(a){document.body.removeChild(a.target)}function load_file_as_text(){var a=document.getElementById("file_to_load").files[0],b=new FileReader;b.onload=function(a){file_loaded=!0,new_component(),editor.setValue(a.target.result)},b.readAsText(a,"UTF-8")}function get_last_line(){var a;return editor.eachLine(function(b){")"===b.text&&(a=editor.getLineNumber(b))}),a}function new_component(){var a='Element["" "0805" "0805" "" 1000 1000 -1.5mm -2.5mm 0 100 ""]\n(\n',b=")";editor.setValue(a+b),editor.clearHistory(),distance_x.attr({visibility:"hidden"}),distance_y.attr({visibility:"hidden"}),$("#status_xy_distance").parent().hide(),global_dragging=!1,global_first_endpoint=!1,global_second_endpoint=!1,global_first_endpoint_object=null,global_second_endpoint_object=null}function nm_to_view(a){return a/1e4}function view_to_nm(a){return 1e4*a}function nm_to_mm(a){return a/1e6}function mm_to_nm(a){return 1e6*a}function nm_to_mil(a){return a/25400}function mil_to_nm(a){return 25400*a}function nm_to_hundredth_mil(a){return a/254}function hundredth_mil_to_nm(a){return 254*a}function parse_length(a){var b=a.indexOf("mm");if(b>-1)return mm_to_nm(a.slice(0,b).trim());var c=a.indexOf("mil");if(c>-1)return mil_to_nm(a.slice(0,c).trim());var d="square";if($.isNumeric(a)){if("round"==d)return mil_to_nm(a.trim());if("square"==d)return hundredth_mil_to_nm(a.trim())}}function mouse_wheel_handler(a){a.preventDefault(),a.wheelDelta>0?3>zoom_level&&(zoom_level+=zoom_level>=.25?.25:.05):zoom_level>.25?zoom_level-=.25:zoom_level>.15&&(zoom_level-=.05),.25>zoom_level?(grid_small.attr({fill:grid_pattern_mm}),grid_big.attr({fill:grid_pattern_cm})):.5>zoom_level?(anchor_size=10,grid_small.attr({fill:grid_pattern_mm}),grid_big.attr({fill:grid_pattern_cm})):(anchor_size=5,grid_small.attr({fill:grid_pattern_tenth_mm}),grid_big.attr({fill:grid_pattern_mm})),console.log(zoom_level),zoom_group.transform("translate("+origin_x+","+origin_y+") scale("+zoom_level+","+zoom_level+")")}$(".status_tooltip").tooltip(),$("a").tooltip(),$("button").tooltip(),$("#controls_mode button").on("click",function(){$(this).addClass("active").siblings().removeClass("active"),"controls_new_pad"==$(this).attr("id")?tool_state="pad":"controls_new_elementline"==$(this).attr("id")?tool_state="elementline":"controls_new_pin"==$(this).attr("id")&&(tool_state="pin")}),$("#controls_soldermask").on("click",function(){$(this).hasClass("active")?($(this).removeClass("active"),solderstop.attr({fill:"none"})):($(this).addClass("active"),solderstop.attr({fill:"green"}))}),$("#controls_undo").on("click",function(){editor.undo()}),$("#controls_redo").on("click",function(){editor.redo()}),$("#controls_new_component").on("click",new_component),$("#load_file").on("click",function(){$("#file_to_load").click()}),$("#file_to_load").on("change",load_file_as_text),$("#save_file").on("click",save_text_as_file),$("#status_xy_distance").parent().hide(),$(".popup").hide(),$("#controls_load_component_from_lib").on("click",list_folders_from_lib),$("ul#gedalib").on("click","a.folder",list_components_in_folder),$("ul#gedalib").on("click","a.file",load_component_from_folder),ElementLine.prototype.update_editor=function(){code=sprintf("    ElementLine[%.2fmm %.2fmm %.2fmm %.2fmm %.2fmm]",nm_to_mm(this.x1),nm_to_mm(this.y1),nm_to_mm(this.x2),nm_to_mm(this.y2),nm_to_mm(this.thickness)),editor.replaceRange(code,{line:this.line_number,ch:0},{line:this.line_number,ch:editor.getLine(this.line_number).length})},ElementLine.prototype.update_anchors=function(){this.anchor_c.attr({cx:nm_to_view(this.x1+(this.x2-this.x1)/2),cy:nm_to_view(this.y1+(this.y2-this.y1)/2),r:anchor_size}),this.anchor_e1.attr({cx:nm_to_view(this.x1),cy:nm_to_view(this.y1),r:anchor_size}),this.anchor_e2.attr({cx:nm_to_view(this.x2),cy:nm_to_view(this.y2),r:anchor_size})},ElementLine.prototype.draw=function(){this.line.attr({x1:nm_to_view(this.x1),y1:nm_to_view(this.y1),x2:nm_to_view(this.x2),y2:nm_to_view(this.y2),strokeWidth:nm_to_view(this.thickness)}),this.update_anchors()};var origin_x=300,origin_y=300,global_dragging=!1,global_first_endpoint=!1,global_second_endpoint=!1,global_first_endpoint_object=null,global_second_endpoint_object=null,anchor_size=5,paper=Snap("#svg"),grid_pattern_tenth_mm=paper.path("M 10 0 L 0 0 0 10").attr({fill:"none",stroke:"gray",strokeWidth:.5}).pattern(0,0,10,10),grid_pattern_mm=paper.path("M 100 0 L 0 0 0 100").attr({fill:"none",stroke:"gray",strokeWidth:2}).pattern(0,0,100,100),grid_pattern_cm=paper.path("M 1000 0 L 0 0 0 1000").attr({fill:"none",stroke:"gray",strokeWidth:5}).pattern(0,0,1e3,1e3),bg=paper.rect(-15e3,-15e3,3e4,3e4,0,0).attr({fill:"#fefefe"}),grid_small=paper.rect(-15e3,-15e3,3e4,3e4,0,0).attr({fill:grid_pattern_tenth_mm}),grid_big=paper.rect(-15e3,-15e3,3e4,3e4,0,0).attr({fill:grid_pattern_mm}),soldermask_bg=paper.rect(-15e3,-15e3,3e4,3e4).attr({fill:"white"}),soldermask_group=paper.group(soldermask_bg),solderstop=paper.rect(-15e3,-15e3,3e4,3e4,0,0).attr({fill:"none","fill-opacity":.5,mask:soldermask_group}),arrow_start=paper.path("M0,3 L-10,0 L0,-3").attr({stroke:"#aaa",fill:"none"}),arrow_end=paper.path("M0,3 L10,0 L0,-3").attr({stroke:"#aaa",fill:"none"}),marker_start=arrow_start.marker(-10,-6,20,12,-10,0),marker_end=arrow_end.marker(-10,-6,20,12,10,0),distance_x_line=paper.line(0,0,0,0).attr({stroke:"#aaa",strokeWidth:2,markerStart:marker_start,markerEnd:marker_end}),distance_x_text=paper.text(0,0,""),distance_x=paper.group(distance_x_line,distance_x_text);distance_x.attr({visibility:"hidden"});var distance_y_line=paper.line(0,0,0,0).attr({stroke:"#aaa",strokeWidth:2,markerStart:marker_start,markerEnd:marker_end}),distance_y_text=paper.text(0,0,""),distance_y=paper.group(distance_y_line,distance_y_text);distance_y.attr({visibility:"hidden"});var center=paper.circle(0,0,10).attr({fill:"none",stroke:"gray",strokeWidth:2}),hidden=!0;$("div#lib").hide(),file_loaded=!1;var tool_state="pad";$(document).bind("keydown","p",add_pad),$("#svg").dblclick(dblclick_handler);var objects=new Array;objects.push("placeholder"),objects.push("placeholder"),Pad.prototype.set_pad_size=function(a){a.width<a.height?(this.thickness=a.width,this.x1=a.x+this.thickness/2,this.y1=a.y+this.thickness/2,this.x2=this.x1,this.y2=this.y1+a.height-this.thickness):(this.thickness=a.height,this.x1=a.x+this.thickness/2,this.y1=a.y+this.thickness/2,this.x2=this.x1+a.width-this.thickness,this.y2=this.y1)},Pad.prototype.get_pad_size=function(){var a=this.x1,b=this.y1,c=this.x2,d=this.y2,e=this.thickness;if(a==c){var f=Math.abs(d-b),g=a-e/2;if(0>d-b)var h=b-e/2-f;else var h=b-e/2;var i=e,j=f+e}else{if(b!=d)return null;var f=Math.abs(c-a);if(0>c-a)var g=a-e/2-f;else var g=a-e/2;var h=b-e/2,i=f+e,j=e}return{x:g,y:h,width:i,height:j}},Pad.prototype.draw=function(){return pad_size=this.get_pad_size(),null==pad_size?(editor.removeLineClass(this.line_number,"background","selected_pad"),editor.addLineClass(this.line_number,"background","error_pad"),void console.log("Rotated pad is not supported.")):pad_size.height<0||pad_size.width<0?(editor.removeLineClass(this.line_number,"background","selected_pad"),editor.addLineClass(this.line_number,"background","error_pad"),void console.log("Not valid pad.")):(editor.removeLineClass(this.line_number,"background","error_pad"),this.pad.attr({x1:nm_to_view(this.x1),y1:nm_to_view(this.y1),x2:nm_to_view(this.x2),y2:nm_to_view(this.y2),strokeWidth:nm_to_view(this.thickness)}),this.mask.attr({x1:nm_to_view(this.x1),y1:nm_to_view(this.y1),x2:nm_to_view(this.x2),y2:nm_to_view(this.y2),strokeWidth:nm_to_view(this.thickness+this.mask_margin)}),console.log(this.mask),this.pad_line_ref.attr({x1:nm_to_view(this.x1)}),this.pad_line_ref.attr({y1:nm_to_view(this.y1)}),this.pad_line_ref.attr({x2:nm_to_view(this.x2)}),this.pad_line_ref.attr({y2:nm_to_view(this.y2)}),this.update_anchors(),this.update_distance_marker(),void console.log("Pad updated with attributes "+this.pad.attr()))},Pad.prototype.update_editor=function(){pad_code=sprintf('    Pad[%.2fmm %.2fmm %.2fmm %.2fmm %.2fmm 0.6mm 1.2mm "" "1" "square"]',nm_to_mm(this.x1),nm_to_mm(this.y1),nm_to_mm(this.x2),nm_to_mm(this.y2),nm_to_mm(this.thickness)),editor.replaceRange(pad_code,{line:this.line_number,ch:0},{line:this.line_number,ch:editor.getLine(this.line_number).length})},Pad.prototype.update_anchors=function(){pad_size=this.get_pad_size(),this.anchor_c.attr({cx:nm_to_view(0),cy:nm_to_view(0),r:anchor_size}),this.anchor_n.attr({cx:nm_to_view(0),cy:nm_to_view(pad_size.height/2),r:anchor_size}),this.anchor_e.attr({cx:nm_to_view(pad_size.width/2),cy:nm_to_view(0),r:anchor_size}),this.anchor_s.attr({cx:nm_to_view(0),cy:nm_to_view(-pad_size.height/2),r:anchor_size}),this.anchor_w.attr({cx:nm_to_view(-pad_size.width/2),cy:nm_to_view(0),r:anchor_size}),this.anchor_ne.attr({cx:nm_to_view(pad_size.width/2),cy:nm_to_view(pad_size.height/2),r:anchor_size}),this.anchor_nw.attr({cx:nm_to_view(-pad_size.width/2),cy:nm_to_view(pad_size.height/2),r:anchor_size}),this.anchor_se.attr({cx:nm_to_view(pad_size.width/2),cy:nm_to_view(-pad_size.height/2),r:anchor_size}),this.anchor_sw.attr({cx:nm_to_view(-pad_size.width/2),cy:nm_to_view(-pad_size.height/2),r:anchor_size}),this.anchors.transform("translate("+nm_to_view(pad_size.x+pad_size.width/2)+","+nm_to_view(pad_size.y+pad_size.height/2)+")")},Pad.prototype.update_distance_marker=function(){if(global_first_endpoint_object==this){var a=this.get_pad_size();distance_x_line.attr({x1:nm_to_view(view_to_nm(parseInt(this.endpoint_anchor.attr("cx"),10))+a.x+a.width/2),y1:nm_to_view(view_to_nm(parseInt(this.endpoint_anchor.attr("cy"),10))+a.y+a.height/2),y2:nm_to_view(view_to_nm(parseInt(this.endpoint_anchor.attr("cy"),10))+a.y+a.height/2)}),distance_y_line.attr({y1:nm_to_view(view_to_nm(parseInt(this.endpoint_anchor.attr("cy"),10))+a.y+a.height/2)});var b=Math.round(distance_x_line.attr("x2")-distance_x_line.attr("x1")),c=Math.round(distance_y_line.attr("y2")-distance_y_line.attr("y1"));distance_x_text.attr({x:+distance_x_line.attr("x1")+b/2,y:-distance_x_line.attr("y1")-10,text:b/100+"mm"}),distance_y_text.attr({x:+distance_y_line.attr("x1")+10,y:-distance_y_line.attr("y1")-c/2,text:c/100+"mm"}),$("#status_xy_distance").text(b/100+"mm, "+c/100+"mm")}if(global_second_endpoint_object==this){var a=this.get_pad_size();distance_x_line.attr({x2:nm_to_view(view_to_nm(parseInt(this.endpoint_anchor.attr("cx"),10))+a.x+a.width/2)}),distance_y_line.attr({x1:nm_to_view(view_to_nm(parseInt(this.endpoint_anchor.attr("cx"),10))+a.x+a.width/2),x2:nm_to_view(view_to_nm(parseInt(this.endpoint_anchor.attr("cx"),10))+a.x+a.width/2),y2:nm_to_view(view_to_nm(parseInt(this.endpoint_anchor.attr("cy"),10))+a.y+a.height/2)});var b=Math.round(distance_x_line.attr("x2")-distance_x_line.attr("x1")),c=Math.round(distance_y_line.attr("y2")-distance_y_line.attr("y1"));distance_x_text.attr({x:+distance_x_line.attr("x1")+b/2,y:-distance_x_line.attr("y1")-10,text:b/100+"mm"}),distance_y_text.attr({x:+distance_y_line.attr("x1")+10,y:-distance_y_line.attr("y1")-c/2,text:c/100+"mm"}),$("#status_xy_distance").text(b/100+"mm, "+c/100+"mm")}},Pin.prototype.update_editor=function(){code=sprintf('    Pin[%.2fmm %.2fmm %.2fmm %.2fmm %.2fmm %.2fmm "" "" ""]',nm_to_mm(this.cx),nm_to_mm(this.cy),nm_to_mm(this.pad_diameter),nm_to_mm(this.clearance),nm_to_mm(this.mask_margin+this.pad_diameter),nm_to_mm(this.hole_diameter)),editor.replaceRange(code,{line:this.line_number,ch:0},{line:this.line_number,ch:editor.getLine(this.line_number).length})},Pin.prototype.update_anchors=function(){this.anchor_c.attr({cx:nm_to_view(this.cx),cy:nm_to_view(this.cy),r:anchor_size}),this.anchor_h.attr({cx:nm_to_view(this.cx+this.hole_diameter/2),cy:nm_to_view(this.cy),r:anchor_size}),this.anchor_p.attr({cx:nm_to_view(this.cx+this.pad_diameter/2),cy:nm_to_view(this.cy),r:anchor_size})},Pin.prototype.draw=function(){this.mask.attr({cx:nm_to_view(this.cx),cy:nm_to_view(this.cy),r:nm_to_view((this.mask_margin+this.pad_diameter)/2)}),this.pad.attr({cx:nm_to_view(this.cx),cy:nm_to_view(this.cy),r:nm_to_view(this.pad_diameter/2)}),this.hole.attr({cx:nm_to_view(this.cx),cy:nm_to_view(this.cy),r:nm_to_view(this.hole_diameter/2)}),this.update_anchors()};var editor=CodeMirror.fromTextArea(document.getElementById("footprint_code"),{lineNumbers:!1,undoDepth:1e4,mode:"text/html",vimMode:!0});editor.on("change",function(a,b){if(b.text.length>b.removed.length)for(var c=b.from.line;c<b.from.line+b.text.length;c++){var d=b.text[c-b.from.line];""!=d&&0==add_object(d,c)}else if(b.text.length<b.removed.length)for(var e=b.from.line,c=b.from.line;c<b.from.line+b.removed.length;c++){var d=b.removed[c-b.from.line];""!=d&&0==remove_object(d,e)&&e--,e++}else for(var c=b.from.line;c<b.from.line+b.text.length;c++){var d=editor.getLine(c);""!=d&&0==edit_object(d,c)}});var hl_line=editor.addLineClass(0,"background","selected_pad");editor.removeLineClass(0,"background","selected_pad"),editor.on("cursorActivity",function(){editor.getLine(editor.getCursor().line).match(/Pad/)&&(editor.removeLineClass(hl_line,"background","selected_pad"),hl_line.text.match(/Pad/)&&objects[editor.getLineNumber(hl_line)].pad.attr({stroke:"#8c96a0"}),hl_line=editor.addLineClass(editor.getCursor().line,"background","selected_pad"),objects[editor.getCursor().line].pad.attr({stroke:"#acb6c0"}))}),editor.on("blur",function(){editor.removeLineClass(hl_line,"background","selected_pad"),hl_line.text.match(/Pad/)&&objects[editor.getLineNumber(hl_line)].pad.attr({stroke:"#8c96a0"})}),$("#vim_mode_cb").click(function(){editor.setOption("vimMode",this.checked)}),new_component();var begin_drag_workspace=function(){1!=global_dragging&&(this.origin_x=origin_x,this.origin_y=origin_y)},drag_workspace=function(a,b){1!=global_dragging&&(origin_x=this.origin_x+a,origin_y=this.origin_y+b,zoom_group.transform("translate("+origin_x+","+origin_y+") scale("+zoom_level+","+zoom_level+")"))};paper.node.addEventListener("mousewheel",mouse_wheel_handler,!1),paper.drag(drag_workspace,begin_drag_workspace,null);var zoom_level=1,zoom_group=paper.group(grid_small,grid_big,center,distance_x,distance_y,solderstop);zoom_group.transform("translate("+origin_x+","+origin_y+") scale("+zoom_level+","+zoom_level+")");
//# sourceMappingURL=pcb-footprint-editor.min.js.map